---
description: 使用 TDD (測試驅動開發) 模式進行功能開發
---

# TDD 開發工作流 (Test-Driven Development Workflow)

當使用者要求使用此工作流進行開發時，請嚴格遵守以下「紅燈區、綠燈區、重構區 (Red-Green-Refactor)」的步驟。在未確定上一個步驟完成前，**絕對不要**跳到下一個步驟。

## 步驟 1：理解需求與規劃 (Planning)
1. 仔細閱讀使用者提出的功能需求。
2. 盤點該功能會影響到的現有檔案，或是需要建立的新檔案。
3. 列出需要撰寫的測試案例清單（Test Cases）。
4. 向使用者確認這份測試案例清單，確認無誤後再進行下一步。

## 步驟 2：撰寫會失敗的測試 (Red)
1. 針對其中**一個**測試案例，在對應的測試檔案中撰寫單元測試。
2. **絕對不要**寫任何產品程式碼 (Production code)。
// turbo
3. 執行測試指令（例如 `pytest <test_file_path>`）。
4. 讀取並記錄失敗的測試結果。必須確認測試是因為「尚未實作該功能」而失敗（AssertionError 或 NotImplementedError），而不是語法錯誤。

## 步驟 3：實作最少量的產品程式碼 (Green)
1. 在對應的源碼檔案中，寫下**剛剛好**可以讓上一個測試通過的程式碼。
2. 不要過度設計 (Over-engineering)，此階段的目標只有「讓測試亮綠燈」。
// turbo
3. 再次執行剛才的測試指令。
4. 確認測試成功通過。如果失敗，請留在目前步驟進行修正，直到測試通過。

## 步驟 4：重構 (Refactor)
1. 檢查剛剛寫的產品程式碼與測試程式碼。是否有重複的邏輯？命名是否清晰？是否有更好的寫法？
2. 進行程式碼清理與重構。
// turbo
3. 再次執行測試，確保重構沒有破壞原本的功能（保持綠燈）。

## 步驟 5：循環或結束
1. 如果還有未完成的測試案例，回到「步驟 2」處理下一個。
2. 如果所有測試皆已通過，任務完成，總結並回報給使用者。
